# Overlay traefik Kustomization
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
  - ../../../../../src/clusters/main/infrastructure/traefik
patches:
  # Remove Tailscale annotations from Traefik service
  - target:
      version: helm.toolkit.fluxcd.io/v2beta1
      kind: HelmRelease
      name: traefik
    patch: |
      - op: remove
        path: /spec/values/service/annotations/tailscale.com~1hostname
  # Remove loadBalancerClass from Traefik service
  - target:
      version: helm.toolkit.fluxcd.io/v2beta1
      kind: HelmRelease
      name: traefik
    patch: |
      - op: remove
        path: /spec/values/service/loadBalancerClass
  # Disable Traefik LoadBalancer service
  - patch: |
      apiVersion: helm.toolkit.fluxcd.io/v2beta1
      kind: HelmRelease
      metadata:
        name: traefik
      spec:
        values:
          service:
            enabled: false
